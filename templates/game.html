<!-- templates/game.html -->
<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8">
  <title>PokeDave - Combat</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body class="bg">
  <header class="topbar">
    <div>Tour: {{ 'Joueur 1' if state.turn==1 else 'Joueur 2' }}</div>
    <div><a class="btn small" href="{{ url_for('index') }}">Revenir accueil</a></div>
  </header>

  <main class="arena">
    <!-- LEFT: Player 1 -->
    <section class="card large">
      <h3>{{ state.p1.name }}</h3>

      {% if state.p1.current %}
        <div class="poke-box">
          <div class="poke-name">{{ state.p1.current.name }}</div>
          <div class="hpbar">
            <div class="hpbar-fill" style="width: {{ (state.p1.current.hp / state.p1.current.max_hp) * 100 }}%"></div>
          </div>
          <div class="hp-text">{{ state.p1.current.hp }} / {{ state.p1.current.max_hp }} PV</div>
          <div class="meta">Type: {{ state.p1.current.type }} — Faiblesse: {{ state.p1.current.weakness }}</div>
          <div class="moves">
            <div>⚔ {{ state.p1.current.moves[0].name }} : {{ state.p1.attack_value }} dmg</div>
            <div>💚 {{ state.p1.current.moves[1].name }} : +{{ state.p1.heal_value }} PV</div>
          </div>
        </div>
      {% else %}
        <div class="empty">Plus de Pokémon</div>
      {% endif %}

      <div class="actions">
        {% if state.turn == 1 and not state.winner %}
          <form method="post" action="{{ url_for('action') }}">
            <input type="hidden" name="action" value="attack">
            <button class="btn danger" type="submit">⚔ Attaquer ({{ state.p1.attack_value }} dmg)</button>
          </form>
          <form method="post" action="{{ url_for('action') }}">
            <input type="hidden" name="action" value="heal">
            <button class="btn success" type="submit">💚 Soigner (+{{ state.p1.heal_value }})</button>
          </form>
          <form method="post" action="{{ url_for('action') }}">
            <input type="hidden" name="action" value="change">
            <button class="btn info" type="submit">🔁 Changer de Pokémon</button>
          </form>
        {% else %}
          <div class="muted">En attente du tour</div>
        {% endif %}
      </div>

      <div class="remaining">Pokémons restants : {{ state.p1.alive_count }}</div>
    </section>

    <!-- RIGHT: Player 2 -->
    <section class="card large">
      <h3>{{ state.p2.name }}</h3>

      {% if state.p2.current %}
        <div class="poke-box">
          <div class="poke-name">{{ state.p2.current.name }}</div>
          <div class="hpbar">
            <div class="hpbar-fill" style="width: {{ (state.p2.current.hp / state.p2.current.max_hp) * 100 }}%"></div>
          </div>
          <div class="hp-text">{{ state.p2.current.hp }} / {{ state.p2.current.max_hp }} PV</div>
          <div class="meta">Type: {{ state.p2.current.type }} — Faiblesse: {{ state.p2.current.weakness }}</div>
          <div class="moves">
            <div>⚔ {{ state.p2.current.moves[0].name }} : {{ state.p2.attack_value }} dmg</div>
            <div>💚 {{ state.p2.current.moves[1].name }} : +{{ state.p2.heal_value }} PV</div>
          </div>
        </div>
      {% else %}
        <div class="empty">Plus de Pokémon</div>
      {% endif %}

      <div class="actions">
        {% if state.turn == 2 and not state.winner %}
          <form method="post" action="{{ url_for('action') }}">
            <input type="hidden" name="action" value="attack">
            <button class="btn danger" type="submit">⚔ Attaquer ({{ state.p2.attack_value }} dmg)</button>
          </form>
          <form method="post" action="{{ url_for('action') }}">
            <input type="hidden" name="action" value="heal">
            <button class="btn success" type="submit">💚 Soigner (+{{ state.p2.heal_value }})</button>
          </form>
          <form method="post" action="{{ url_for('action') }}">
            <input type="hidden" name="action" value="change">
            <button class="btn info" type="submit">🔁 Changer de Pokémon</button>
          </form>
        {% else %}
          <div class="muted">En attente du tour</div>
        {% endif %}
      </div>

      <div class="remaining">Pokémons restants : {{ state.p2.alive_count }}</div>
    </section>
  </main>
</body>
</html>
